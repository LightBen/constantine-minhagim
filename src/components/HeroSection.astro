---
import { getLangFromUrl, useTranslations } from "../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const { title, subtitle } = Astro.props;

import { getImage } from "astro:assets";

import bgArt from "../assets/img/bg-home/jlm-const-bg-art.webp";
import bgArtSm from "../assets/img/bg-home/jlm-const-bg-art-sm.webp";
import bgMorning from "../assets/img/bg-home/jlm-const-bg-morning.webp";
import bgMorningSm from "../assets/img/bg-home/jlm-const-bg-morning-sm.webp";
import bgDay from "../assets/img/bg-home/jlm-const-bg-day.webp";
import bgDaySm from "../assets/img/bg-home/jlm-const-bg-day-sm.webp";
import bgEve from "../assets/img/bg-home/jlm-const-bg-eve.webp";
import bgEveSm from "../assets/img/bg-home/jlm-const-bg-eve-sm.webp";
import bgNight from "../assets/img/bg-home/jlm-const-bg-night.webp";
import bgNightSm from "../assets/img/bg-home/jlm-const-bg-night-sm.webp";

// Optimize all images
const optArt = await getImage({ src: bgArt, format: "webp" });
const optArtSm = await getImage({ src: bgArtSm, format: "webp" });
const optMorning = await getImage({ src: bgMorning, format: "webp" });
const optMorningSm = await getImage({ src: bgMorningSm, format: "webp" });
const optDay = await getImage({ src: bgDay, format: "webp" });
const optDaySm = await getImage({ src: bgDaySm, format: "webp" });
const optEve = await getImage({ src: bgEve, format: "webp" });
const optEveSm = await getImage({ src: bgEveSm, format: "webp" });
const optNight = await getImage({ src: bgNight, format: "webp" });
const optNightSm = await getImage({ src: bgNightSm, format: "webp" });

const backgrounds = {
    morning: { lg: optMorning.src, sm: optMorningSm.src },
    day: { lg: optDay.src, sm: optDaySm.src },
    evening: { lg: optEve.src, sm: optEveSm.src },
    night: { lg: optNight.src, sm: optNightSm.src },
    art: { lg: optArt.src, sm: optArtSm.src },
};
---

<section
    class="relative w-full h-[60vh] min-h-[500px] flex items-center justify-center overflow-hidden bg-brand-navy"
>
    <!-- Background Image with Parallax-like fixed attachment or absolute -->
    <div class="absolute inset-0 z-0">
        <picture id="hero-bg-picture" class="transition-opacity duration-1000">
            <source
                id="hero-bg-source"
                media="(max-width: 640px)"
                srcset={optArtSm.src}
            />
            <img
                id="hero-bg-img"
                src={optArt.src}
                alt="Constantine Bridge"
                class="w-full h-full object-cover"
                width="1920"
                height="1080"
            />
        </picture>
        <div
            class="absolute inset-0 bg-gradient-to-b from-black/40 via-black/20 to-brand-navy/90"
        >
        </div>
    </div>

    <!-- Content -->
    <div
        class="relative z-10 text-center px-4 max-w-4xl mx-auto flex flex-col items-center"
    >
        <!-- Logo Icon (Large) -->
        <div
            class="mb-6 animate-fade-in opacity-0"
            style="animation-delay: 0.2s; animation-fill-mode: forwards;"
        >
            <img
                src="/cm-logo-icon.svg"
                alt="Logo"
                class="w-20 h-20 md:w-28 md:h-28 filter brightness-0 invert drop-shadow-xl"
            />
        </div>

        <!-- Title -->
        <h1
            class="text-3xl md:text-5xl font-serif font-bold text-white mb-4 drop-shadow-lg tracking-wide uppercase animate-slide-up opacity-0"
            style="animation-delay: 0.4s; animation-fill-mode: forwards;"
        >
            <span class="text-white">{t("site.title.1")}</span>
            <span class="text-white">{t("site.title.2")}</span>
        </h1>

        <!-- Subtitle -->
        <p
            class="text-base md:text-xl text-gray-200 font-light max-w-2xl mx-auto mb-8 drop-shadow-md animate-slide-up opacity-0"
            style="animation-delay: 0.6s; animation-fill-mode: forwards;"
        >
            {t("hero.subtitle")}
        </p>
    </div>

    <!-- Client-side logic for dynamic background -->
    <script define:vars={{ backgrounds }} is:inline>
        document.addEventListener("astro:page-load", () => {
            const hour = new Date().getHours();
            let phase = "art";

            if (hour >= 6 && hour < 11) {
                phase = "morning";
            } else if (hour >= 11 && hour < 17) {
                phase = "day";
            } else if (hour >= 17 && hour < 20) {
                phase = "evening";
            } else {
                phase = "night";
            }

            const picSource = document.getElementById("hero-bg-source");
            const picImg = document.getElementById("hero-bg-img");

            if (picSource && picImg && backgrounds[phase]) {
                picSource.srcset = backgrounds[phase].sm;
                picImg.src = backgrounds[phase].lg;
            }
        });
    </script>
</section>
